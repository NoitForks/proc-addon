<!DOCTYPE HTML>
<html>
<head>
  <link rel="stylesheet" href="resource://jid1-gusfgyrkklgvkq-at-jetpack/proc-addon/data/themes/blue/style.css" type="text/css" />
  <style type="text/css"> 
    * {font-family:arial,sans-serif;}
    body {font-size:75%; width:2500px}
    
  </style>
  <script type="text/javascript" src="resource://jid1-gusfgyrkklgvkq-at-jetpack/proc-addon/data/jquery/jquery-1.7.2.min.js"> </script>
  <script type="text/javascript" src="resource://jid1-gusfgyrkklgvkq-at-jetpack/proc-addon/data/jquery/jquery.tablesorter.js"> </script>
</head>
<body>                              
<script type="application/javascript;version=1.8" src="resource://jid1-gusfgyrkklgvkq-at-jetpack/proc-addon/data/ntapi.js"> </script>  
<script type="application/javascript;version=1.8" src="resource://jid1-gusfgyrkklgvkq-at-jetpack/proc-addon/data/list.js"> </script>

<div id="pres">Waiting...</div>
<table id="proc_table" cellspacing="1" class="tablesorter" style="display:none">
  <thead><tr>
    <th>PID</th>
    <th>Image Name</th>
    <th>Parent PID</th>
    <th>Page Faults</th>
    <th>Private Memory</th>
    <th>IO Operations</th>
    <th>IO Bytes</th>
    <th>IO Bytes/sec</th>
    <th>Page Faults/sec</th>
    <th>CPU</th>
    <th>Image File Name</th>
    <th>Services</th>
    <th>Company Name</th>
    <th>Description</th>
    <th>Version</th>
  </tr></thead>
  <tbody></tbody>
</table>

<script type="application/javascript;version=1.8">
tab = document.getElementById("proc_table");

var s1Time = (new Date()).getTime();
s1 = enumProcesses();
window.setTimeout("printProc()", 1000);

function printProc(){
  var timeDiff = ((new Date()).getTime()-s1Time)/1000;
  var s2 = enumProcesses();
  var pDelta = delta(s1, s2, timeDiff);
  var pSvc = enumProcServices();
  
  for (pid in s2){
    var p = s2[pid], pd = pDelta[pid], ps = pSvc[pid];
    var fn = imageFileName(pid), vi = versionInfo(fn);
    var svcList = [];
    for(var i in ps) svcList.push(ps[i].lpDisplayName);
    
    addTabRow([pid, p.ImageName, p.InheritedFromUniqueProcessId,
      addCommas(p.PageFaultCount), addCommas(p.WorkingSetPrivateSize), 
      addCommas(p.IOCount), addCommas(p.IOTransfer),
      addCommas(pd.IOTransferDelta.toFixed(0)), 
      addCommas(pd.PageFaultCountDelta.toFixed(0)), 
      (pd.CPU < 0.0001) ? "" : (pd.CPU*100).toFixed(2) + "%",
      fn, svcList.join("<br />"), vi.CompanyName, vi.FileDescription,
      vi.ProductVersion
    ]);
  }
  $("#proc_table").tablesorter({debug: true}); 
  
  document.getElementById("pres").style.display = "none";
  tab.style.display = "block";
}

function addTabRow(arr){
  var tbody = tab.getElementsByTagName("tbody")[0];
  var row = tbody.insertRow(-1);
  for(var i in arr)
    row.insertCell(i).innerHTML = arr[i];
}

function addCommas(nStr) {
  nStr += '';
  x = nStr.split('.');
  x1 = x[0];
  x2 = x.length > 1 ? '.' + x[1] : '';
  var rgx = /(\d+)(\d{3})/;
  while (rgx.test(x1))
    x1 = x1.replace(rgx, '$1' + ',' + '$2');
  return x1 + x2;
}

</script>

</body>
</html>
